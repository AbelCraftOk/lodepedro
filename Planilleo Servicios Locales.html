<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="icon" type="image/png" href="./logo.png">
<title>Planilleo de Servicios Locales - LDP</title>
<style>
  :root{
    --bg:#f5f9fb;
    --card:#eaf3f8;
    --accent:#cfe9f5;
    --text:#223344;
    --muted:#557;
    --button:#bfe0ee;
    --radius:10px;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    line-height:1.3;
  }
  header{
    background:linear-gradient(90deg,var(--card),var(--accent));
    padding:12px 18px;
    display:flex;
    align-items:center;
    gap:12px;
    box-shadow:0 2px 8px rgba(34,51,68,0.06);
  }
  header img.logo{
    width:48px;height:48px;object-fit:contain;border-radius:8px;
  }
  header h1{
    font-size:16px;margin:0;
  }
  nav{ display:flex; gap:8px; margin-left:auto; }
  nav button{
    background:transparent;border:1px solid transparent;padding:8px 12px;border-radius:8px;cursor:pointer;
  }
  nav button.active{ background:var(--button);border-color:rgba(34,51,68,0.06); }
  main{ padding:20px; max-width:980px;margin:18px auto; }
  .recuadro{
    background:var(--card);
    border-radius:var(--radius);
    padding:14px;
    margin:12px 0;
    box-shadow:0 1px 0 rgba(255,255,255,0.6) inset;
  }
  h1{ font-size:26px;margin:6px 0 8px 0;}
  h2{ font-size:18px;margin:0 0 8px 0;color:var(--muted)}
  h3{ font-size:14px;margin:0;color:var(--muted)}
  .grid{ display:grid; gap:12px; grid-template-columns: 1fr 1fr; align-items:start; }
  .btn-primary{
    display:inline-block;padding:10px 14px;border-radius:10px;border:0;background:var(--button);cursor:pointer;
    box-shadow:0 2px 6px rgba(34,51,68,0.06);
  }
  table{ width:100%; border-collapse:collapse; background:transparent; }
  th, td{ padding:10px;border:1px solid rgba(34,51,68,0.06); text-align:left; background:rgba(255,255,255,0.4); }
  th{ background:rgba(255,255,255,0.6); font-weight:600; color:var(--muted) }
  input[type="text"], input[type="time"]{
    width:100%; padding:8px;border-radius:8px;border:1px solid rgba(34,51,68,0.06);
    background:transparent;
  }
  .hidden{ display:none; }
  footer{ text-align:center;color:var(--muted); margin-top:18px; font-size:13px; }
  @media(max-width:700px){
    .grid{ grid-template-columns: 1fr; }
    header{ padding:10px; }
  }
</style>
</head>
<body>
  <header>
    <img src="./logo.png" class="logo" alt="logo">
    <h1>Planilleo de Servicios Locales - LDP</h1>
    <nav>
      <button id="nav-inicio" class="active" onclick="showTab('inicio')">Inicio</button>
      <button id="nav-add" onclick="showTab('add-planilla')">Agregar</button>
      <button id="nav-ver" onclick="showTab('ver-planilla')">Ver</button>
    </nav>
  </header>
  <main>
    <section id="inicio" class="tab">
      <h1>Planilleo de Servicios Locales</h1>
      <h3>Dueño LoDePedro</h3>
      <div class="recuadro">
        <h2>Agregar una nueva planilla</h2>
        <button class="btn-primary" onclick="showTab('add-planilla')">Ir</button>
      </div>
      <div class="recuadro">
        <h2>Examinar Fecha para ver la planilla de ese día</h2>
        <button class="btn-primary" onclick="showTab('ver-planilla')">Ir</button>
      </div>
    </section>
    <section id="add-planilla" class="tab hidden">
      <div class="recuadro">
        <h2>Agregar planilla</h2>
        <p style="margin:6px 0 12px 0;color:var(--muted)">Rellena los campos de hora o escribe texto libre.</p>
        <table>
          <thead>
            <tr>
              <th>Servicio Realizado</th>
              <th>Hora de la 1er Pasada</th>
              <th>Hora de la 2da Pasada</th>
              <th>Hora de la 3ra Pasada</th>
            </tr>
          </thead>
          <tbody id="add-rows">
            <tr>
              <td><input type="text" value="Barrer Comedor" data-servicio></td>
              <td><input type="time" data-hora1></td>
              <td><input type="time" data-hora2></td>
              <td><input type="time" data-hora3></td>
            </tr>
            <tr>
              <td><input type="text" value="Lavar" data-servicio></td>
              <td><input type="time" data-hora1></td>
              <td><input type="time" data-hora2></td>
              <td><input type="time" data-hora3></td>
            </tr>
            <tr>
              <td><input type="text" value="Limpiar mesa Comedor" data-servicio></td>
              <td><input type="time" data-hora1></td>
              <td><input type="time" data-hora2></td>
              <td><input type="time" data-hora3></td>
            </tr>
          </tbody>
        </table>
        <div style="margin-top:12px; display:flex; gap:8px;">
          <button class="btn-primary" onclick="agregarPlanilla()">Agregar Planilla</button>
          <button class="btn-primary" onclick="resetAddTable()">Limpiar</button>
        </div>
      </div>
    </section>
    <section id="ver-planilla" class="tab hidden">
      <div class="recuadro">
        <h4>Seleccione su .html con la planilla que desea revisar</h4>
        <input id="file-picker" type="file" accept=".html" onchange="verPlanilla(event)">
      </div>
      <div id="tabla-de-planilla" class="recuadro" style="min-height:120px;">
        <p style="color:var(--muted)">Ningún archivo cargado.</p>
      </div>
    </section>
  </main>
  <footer>LoDePedro · Planilleo de Servicios Locales</footer>
<script>
function showTab(tab){
  document.querySelectorAll('.tab').forEach(s => s.classList.add('hidden'));
  document.getElementById(tab).classList.remove('hidden');
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  const map = { 'inicio':'nav-inicio','add-planilla':'nav-add','ver-planilla':'nav-ver' };
  if(map[tab]) document.getElementById(map[tab]).classList.add('active');
}
function resetAddTable(){
  const rows = document.querySelectorAll('#add-rows tr');
  rows.forEach(r=>{
    r.querySelectorAll('input').forEach(i => {
      if(i.dataset.servicio!==undefined){
      } else {
        i.value = '';
      }
    });
  });
}
function agregarPlanilla(){
  const rows = Array.from(document.querySelectorAll('#add-rows tr'));
  const datos = rows.map(r=>{
    return {
      servicio: r.querySelector('[data-servicio]').value.trim(),
      hora1: r.querySelector('[data-hora1]').value || '',
      hora2: r.querySelector('[data-hora2]').value || '',
      hora3: r.querySelector('[data-hora3]').value || ''
    };
  });
  const now = new Date();
  const dd = String(now.getDate()).padStart(2,'0');
  const mm = String(now.getMonth()+1).padStart(2,'0');
  const yyyy = now.getFullYear();
  const hh = String(now.getHours()).padStart(2,'0');
  const min = String(now.getMinutes()).padStart(2,'0');
  const displayDate = `${dd}/${mm}/${yyyy}`;
  const displayTime = `${hh}:${min}`;
  let tableHtml = `<table>
    <thead>
      <tr>
        <th>Servicio Realizado</th>
        <th>Hora de la 1er Pasada</th>
        <th>Hora de la 2da Pasada</th>
        <th>Hora de la 3ra Pasada</th>
      </tr>
    </thead>
    <tbody>
  `;
  datos.forEach(d=>{
    tableHtml += `<tr>
      <td>${escapeHtml(d.servicio)}</td>
      <td>${escapeHtml(d.hora1)}</td>
      <td>${escapeHtml(d.hora2)}</td>
      <td>${escapeHtml(d.hora3)}</td>
    </tr>`;
  });
  tableHtml += `</tbody></table>`;
  const filename = `${dd}-${mm}-${yyyy} - ${hh}-${min}.html`;
  const blob = new Blob([tableHtml], {type: 'text/html;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
  URL.revokeObjectURL(url);
  resetAddTable();
  showTab('inicio');
}
function verPlanilla(event){
  const fileInput = event.target;
  const file = fileInput.files && fileInput.files[0];
  if(!file) return;
  if(!file.name.toLowerCase().endsWith('.html')){
    alert('Seleccione un archivo con extensión .html');
    fileInput.value = '';
    return;
  }
  const reader = new FileReader();
  reader.onload = function(e){
    const content = e.target.result;
    const container = document.getElementById('tabla-de-planilla');
    container.innerHTML = content;
    container.scrollIntoView({behavior:'smooth'});
  };
  reader.onerror = function(){
    alert('Error leyendo el archivo.');
  };
  reader.readAsText(file, 'UTF-8');
}
function escapeHtml(str){
  if(!str) return '';
  return str
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'",'&#39;');
}
showTab('inicio');
</script>
</body>

</html>
